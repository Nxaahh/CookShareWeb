import{a as ie,j as re,l as ne}from"./chunk-5HFAIMXN.js";import{$ as G,A as m,B as W,C as B,D as g,E as f,F as h,L as O,M as j,N as L,P as A,Z as H,_ as q,aa as z,ba as X,c as y,ca as J,d as V,da as K,db as te,e as C,ea as Q,fa as Y,g as b,ga as Z,ha as $,ia as ee,ib as oe,j as R,k as I,n as U,o as l,p as w,q as N,r as _,s as p,t as a,u as s,v as M,w as E,x as v,y as u,z as F}from"./chunk-HEWK7BMS.js";var d=[];for(let e=0;e<256;++e)d.push((e+256).toString(16).slice(1));function ae(e,t=0){return(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase()}var P,le=new Uint8Array(16);function T(){if(!P){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");P=crypto.getRandomValues.bind(crypto)}return P(le)}var ce=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),k={randomUUID:ce};function me(e,t,i){if(k.randomUUID&&!t&&!e)return k.randomUUID();e=e||{};let r=e.random??e.rng?.()??T();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){if(i=i||0,i<0||i+16>t.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);for(let o=0;o<16;++o)t[i+o]=r[o];return t}return ae(r)}var D=me;var x=class e{constructor(t){this.database=t}guardarReceta(t){return y(this,null,function*(){let i=re(this.database,`recipes/${t.id_receta}`);return ne(i,t)})}static \u0275fac=function(i){return new(i||e)(b(ie))};static \u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"})};var S=class e{constructor(t){this.http=t}cloudName="dp18ba4tj";unsignedUploadPreset="cookshare_unsigned";subirImagen(t){return y(this,null,function*(){let i=new FormData;return i.append("file",t),i.append("upload_preset",this.unsignedUploadPreset),(yield V(this.http.post(`https://api.cloudinary.com/v1_1/${this.cloudName}/image/upload`,i))).secure_url})}static \u0275fac=function(i){return new(i||e)(b(A))};static \u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"})};function ge(e,t){if(e&1&&(a(0,"div",24),m(1),s()),e&2){let i=u();l(),B(" ",i.error," ")}}function fe(e,t){if(e&1&&(a(0,"option",25),m(1),s()),e&2){let i=t.$implicit;p("value",i),l(),W(i)}}function he(e,t){if(e&1&&M(0,"img",26),e&2){let i=u();p("src",i.imagenPreview,U)}}function ye(e,t){if(e&1){let i=E();a(0,"div",27)(1,"input",28),h("ngModelChange",function(o){let n=R(i).index,c=u();return f(c.ingredientes[n],o)||(c.ingredientes[n]=o),I(o)}),s()()}if(e&2){let i=t.index,r=u();l(),F("name","ingrediente",i,""),g("ngModel",r.ingredientes[i])}}function _e(e,t){if(e&1){let i=E();a(0,"div",27)(1,"input",29),h("ngModelChange",function(o){let n=R(i).index,c=u();return f(c.pasos[n],o)||(c.pasos[n]=o),I(o)}),s()()}if(e&2){let i=t.index,r=u();l(),F("name","paso",i,""),g("ngModel",r.pasos[i])}}var de=class e{constructor(t,i,r){this.recetasService=t;this.cloudinaryService=i;this.auth=r}titulo="";descripcion="";tiempoEstimado=null;categoria="";categorias=["Postres","Platos principales","Bebidas","Entrantes","Sopas","Ensaladas"];ingredientes=[""];pasos=[""];imagenFile=null;imagenPreview=null;error="";agregarIngrediente(){this.ingredientes.push("")}agregarPaso(){this.pasos.push("")}onImagenSeleccionada(t){let i=t.target;if(i.files&&i.files[0]){this.imagenFile=i.files[0];let r=new FileReader;r.onload=()=>{this.imagenPreview=r.result},r.readAsDataURL(this.imagenFile)}}guardarReceta(){return y(this,null,function*(){if(this.error="",!this.titulo.trim()||!this.descripcion.trim()||!this.categoria||!this.tiempoEstimado){this.error="Todos los campos son obligatorios.";return}if(!this.imagenFile){this.error="La imagen es obligatoria.";return}let t=this.ingredientes.filter(c=>c.trim()!==""),i=this.pasos.filter(c=>c.trim()!=="");if(t.length<1){this.error="Debe haber al menos un ingrediente.";return}if(i.length<1){this.error="Debe haber al menos un paso.";return}let r="";try{r=yield this.cloudinaryService.subirImagen(this.imagenFile)}catch(c){console.error("Error al subir la imagen:",c),this.error="No se pudo subir la imagen.";return}let o=this.auth.currentUser?.uid||"anonimo",n={id_receta:D(),titulo:this.titulo.trim(),descripcion:this.descripcion.trim(),tiempoEstimado:this.tiempoEstimado.toString(),categoria:this.categoria,ingredientes:t,pasos:i,imagenReceta:r,id_usuario:o,fechaPublicacion:new Date().toISOString()};yield this.recetasService.guardarReceta(n),this.resetFormulario()})}resetFormulario(){this.titulo="",this.descripcion="",this.tiempoEstimado=null,this.categoria="",this.ingredientes=[""],this.pasos=[""],this.imagenFile=null,this.imagenPreview=null,this.error=""}trackByIndex(t,i){return t}static \u0275fac=function(i){return new(i||e)(w(x),w(S),w(te))};static \u0275cmp=N({type:e,selectors:[["app-crear-receta"]],decls:37,vars:11,consts:[[1,"container","py-5"],[1,"row","justify-content-center"],[1,"col-md-10","col-lg-8"],[1,"card","shadow-lg","border-0","rounded-4","p-4"],[1,"card-body"],[1,"mb-4","text-center","fw-bold","text-gradient"],["class","alert alert-danger text-center",4,"ngIf"],[3,"ngSubmit"],[1,"mb-3"],["type","text","placeholder","T\xEDtulo","name","titulo","required","",1,"form-control","rounded-3","shadow-sm",3,"ngModelChange","ngModel"],["rows","3","placeholder","Descripci\xF3n","name","descripcion",1,"form-control","rounded-3","shadow-sm",3,"ngModelChange","ngModel"],["type","number","placeholder","Tiempo estimado (min)","name","tiempoEstimado",1,"form-control","rounded-3","shadow-sm",3,"ngModelChange","ngModel"],["name","categoria",1,"form-select","rounded-3","shadow-sm",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"mb-4","text-center"],["type","file",1,"form-control",3,"change"],["alt","Vista previa","class","img-fluid rounded mt-3 shadow-sm","style","max-height: 200px;",3,"src",4,"ngIf"],[1,"mb-4"],[1,"text-morado","fw-bold"],["class","mb-2",4,"ngFor","ngForOf","ngForTrackBy"],["type","button",1,"btn","btn-outline-primary","rounded-pill","mt-2",3,"click"],["type","button",1,"btn","btn-outline-secondary","rounded-pill","mt-2",3,"click"],[1,"d-grid","gap-2"],["type","submit",1,"btn","btn-morado","btn-lg","rounded-pill"],[1,"alert","alert-danger","text-center"],[3,"value"],["alt","Vista previa",1,"img-fluid","rounded","mt-3","shadow-sm",2,"max-height","200px",3,"src"],[1,"mb-2"],["placeholder","Ingrediente",1,"form-control","rounded-3","shadow-sm",3,"ngModelChange","ngModel","name"],["placeholder","Paso",1,"form-control","rounded-3","shadow-sm",3,"ngModelChange","ngModel","name"]],template:function(i,r){i&1&&(M(0,"app-navbar"),a(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"h2",5),m(7,"Crear Receta"),s(),_(8,ge,2,1,"div",6),a(9,"form",7),v("ngSubmit",function(){return r.guardarReceta()}),a(10,"div",8)(11,"input",9),h("ngModelChange",function(n){return f(r.titulo,n)||(r.titulo=n),n}),s()(),a(12,"div",8)(13,"textarea",10),h("ngModelChange",function(n){return f(r.descripcion,n)||(r.descripcion=n),n}),s()(),a(14,"div",8)(15,"input",11),h("ngModelChange",function(n){return f(r.tiempoEstimado,n)||(r.tiempoEstimado=n),n}),s()(),a(16,"div",8)(17,"select",12),h("ngModelChange",function(n){return f(r.categoria,n)||(r.categoria=n),n}),_(18,fe,2,2,"option",13),s()(),a(19,"div",14)(20,"input",15),v("change",function(n){return r.onImagenSeleccionada(n)}),s(),_(21,he,1,1,"img",16),s(),a(22,"div",17)(23,"h5",18),m(24,"Ingredientes"),s(),_(25,ye,2,3,"div",19),a(26,"button",20),v("click",function(){return r.agregarIngrediente()}),m(27,"+ Ingrediente"),s()(),a(28,"div",17)(29,"h5",18),m(30,"Pasos"),s(),_(31,_e,2,3,"div",19),a(32,"button",21),v("click",function(){return r.agregarPaso()}),m(33,"+ Paso"),s()(),a(34,"div",22)(35,"button",23),m(36," Guardar Receta "),s()()()()()()()()),i&2&&(l(8),p("ngIf",r.error),l(3),g("ngModel",r.titulo),l(2),g("ngModel",r.descripcion),l(2),g("ngModel",r.tiempoEstimado),l(2),g("ngModel",r.categoria),l(),p("ngForOf",r.categorias),l(3),p("ngIf",r.imagenPreview),l(4),p("ngForOf",r.ingredientes)("ngForTrackBy",r.trackByIndex),l(6),p("ngForOf",r.pasos)("ngForTrackBy",r.trackByIndex))},dependencies:[L,O,j,ee,J,Y,Z,H,K,Q,q,G,$,X,z,oe],styles:[".text-gradient[_ngcontent-%COMP%]{background:linear-gradient(90deg,#a259c6,#6d28d9);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.text-morado[_ngcontent-%COMP%]{color:#a259c6}.btn-morado[_ngcontent-%COMP%]{background:linear-gradient(90deg,#a259c6,#6d28d9);color:#fff;font-weight:600;border:none;transition:background .2s}.btn-morado[_ngcontent-%COMP%]:hover{background:linear-gradient(90deg,#6d28d9,#a259c6)}"]})};export{de as CrearRecetaComponent};
